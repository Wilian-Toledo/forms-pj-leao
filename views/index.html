<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulário - Leão</title>
  <link rel="stylesheet" href="/public/styles.css">
</head>
<body>
  <header class="header">
    <img src="/public/logo-leao.png" alt="Logo Leão" class="logo">
    <h1>Cadastro Pessoa Jurídica</h1>
  </header>

  <form id="formPJ" action="/enviar" method="POST" enctype="multipart/form-data">
    <!-- Dados da Empresa -->
    <section>
      <h2>Dados da Empresa</h2>
      <label>CNPJ*<input type="text" name="cnpj" required></label>
      <label>Razão Social*<input type="text" name="razao_social" required></label>
      <label>Telefone*<input type="text" name="telefone" required></label>
      <label>Email*<input type="email" name="email" required></label>
    </section>

    <!-- Endereço Principal -->
    <section>
      <h2>Endereço Principal</h2>
      <label>CEP*<input type="text" name="cep" id="cep" required></label>
      <label>Rua*<input type="text" name="rua" id="rua" required></label>
      <label>Número*<input type="text" name="numero" required></label>
      <label>Bairro*<input type="text" name="bairro" id="bairro" required></label>
      <label>Cidade*<input type="text" name="cidade" id="cidade" required></label>
      <label>Estado*<input type="text" name="estado" id="estado" required></label>
    </section>

    <!-- Perguntas Condicionais -->
    <section>
      <label>O endereço de entrega é o mesmo do principal?*
        <select id="enderecoEntregaIgual" name="entrega_igual" required>
          <option value="">Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">Não</option>
        </select>
      </label>
      <div id="secaoEntrega" class="condicional">
        <h2>Endereço de Entrega</h2>
        <label>CEP<input type="text" name="cep_entrega"></label>
        <label>Rua<input type="text" name="rua_entrega"></label>
        <label>Número<input type="text" name="numero_entrega"></label>
        <label>Bairro<input type="text" name="bairro_entrega"></label>
        <label>Cidade<input type="text" name="cidade_entrega"></label>
        <label>Estado<input type="text" name="estado_entrega"></label>
      </div>

      <label>O endereço de cobrança é o mesmo do principal?*
        <select id="enderecoCobrancaIgual" name="cobranca_igual" required>
          <option value="">Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">Não</option>
        </select>
      </label>
      <div id="secaoCobranca" class="condicional">
        <h2>Endereço de Cobrança</h2>
        <label>CEP<input type="text" name="cep_cobranca"></label>
        <label>Rua<input type="text" name="rua_cobranca"></label>
        <label>Número<input type="text" name="numero_cobranca"></label>
        <label>Bairro<input type="text" name="bairro_cobranca"></label>
        <label>Cidade<input type="text" name="cidade_cobranca"></label>
        <label>Estado<input type="text" name="estado_cobranca"></label>
      </div>
    </section>

    <!-- Dados Bancários -->
    <section>
      <h2>Dados Bancários</h2>
      <label>Banco<select name="banco" id="bancoSelect"></select></label>
      <label>Agência<input type="text" name="agencia"></label>
      <label>Conta<input type="text" name="conta"></label>
    </section>

    <!-- Uploads -->
    <section>
      <h2>Documentos</h2>
      <label>Contrato Social<input type="file" name="contrato_social"></label>
      <label>Comprovante de Endereço<input type="file" name="comprovante_endereco"></label>
    </section>

    <button type="submit">Enviar</button>
  </form>

  <script>
    // Máscaras
    function mascaraCNPJ(v) {
      v = v.replace(/\D/g, "");
      v = v.replace(/^(\d{2})(\d)/, "$1.$2");
      v = v.replace(/^(\d{2})\.(\d{3})(\d)/, "$1.$2.$3");
      v = v.replace(/\.(\d{3})(\d)/, ".$1/$2");
      v = v.replace(/(\d{4})(\d)/, "$1-$2");
      return v;
    }
    function mascaraTelefone(v) {
      v = v.replace(/\D/g, "");
      v = v.replace(/^(\d{2})(\d)/g, "($1) $2");
      v = v.replace(/(\d{4,5})(\d{4})$/, "$1-$2");
      return v;
    }
    function mascaraCEP(v) {
      v = v.replace(/\D/g, "");
      v = v.replace(/^(\d{5})(\d)/, "$1-$2");
      return v;
    }

    document.querySelector('input[name="cnpj"]').addEventListener('input', e => e.target.value = mascaraCNPJ(e.target.value));
    document.querySelector('input[name="telefone"]').addEventListener('input', e => e.target.value = mascaraTelefone(e.target.value));
    document.getElementById('cep').addEventListener('input', e => e.target.value = mascaraCEP(e.target.value));

    // ViaCEP
    document.getElementById('cep').addEventListener('blur', function() {
      let cep = this.value.replace(/\D/g, '');
      if (cep.length === 8) {
        fetch(`https://viacep.com.br/ws/${cep}/json/`)
          .then(res => res.json())
          .then(data => {
            if (!data.erro) {
              document.getElementById('rua').value = data.logradouro;
              document.getElementById('bairro').value = data.bairro;
              document.getElementById('cidade').value = data.localidade;
              document.getElementById('estado').value = data.uf;
            }
          });
      }
    });

    // Condicionais
    document.getElementById('enderecoEntregaIgual').addEventListener('change', function() {
      document.getElementById('secaoEntrega').style.display = this.value === 'nao' ? 'block' : 'none';
    });
    document.getElementById('enderecoCobrancaIgual').addEventListener('change', function() {
      document.getElementById('secaoCobranca').style.display = this.value === 'nao' ? 'block' : 'none';
    });

    // Lista de Bancos
    fetch("https://brasilapi.com.br/api/banks/v1")
      .then(res => res.json())
      .then(bancos => {
        let select = document.getElementById('bancoSelect');
        bancos.forEach(b => {
          let opt = document.createElement('option');
          opt.value = b.code;
          opt.textContent = `${b.code} - ${b.fullName}`;
          select.appendChild(opt);
        });
      });
  </script>
</body>
</html>
